<!DOCTYPE html>
<html> 
<head>
<meta charset=”UTF-8" />
	<title>DUMP978-WX Data</title>
	<link rel="stylesheet" href="/leaflet/leaflet.css"/>
	<script type="text/javascript", src="/leaflet/leaflet.js"></script>
	<script  type="text/javascript", src="/leaflet/jquery.js"></script> 
	<script  type="text/javascript", src="/leaflet/leaflet-realtime.js"></script>  
	
<style>

#wrapper {
	margin: 0 auto;
  	width: 100%;
}

#panel{
 	float: left;
	width: 100%;
  	height:40px;
	background-color: #175B81;
	color:white;
}

#map {
  	float: left;
  	width: 80%;
  	height:900px;
}

.sidebar {
	float: left;
 	width: 20%;
  	height:800px;
	background-color: #d3eaf8;
   	color: #175B81;
}

#footer {
	float: left;
	background-color: #175B81;
	color: white;
  	width: 100%;
  	height:20px
}

.container {
  	display: block;
  	position: relative;
  	padding-left: 1px;
  	margin-bottom: 12px;
  	cursor: pointer;
  	font-size: 10px;
  	-webkit-user-select: none;
  	-moz-user-select: none;
  	-ms-user-select: none;
  	user-select: none;
}

.text-labels {
	font-weight: bold;
    color:#006400;
	font-family: "Arial Black";
	font-size: 20px ;
    line-height:14px;
    text-align:center;
   }
   
table, th, td 
	{
		margin:0px 5px;
		border:solid 1px #333; 
		padding:2px 4px;
		font:10px arial;
	}
th {
		font-size:11px;
		font-weight:bold;
		
	}
td {
		font-size:11px;
		font-weight:normal
	}
tr:nth-child(even)  {
		background: #E6BECF;
	}
tr:nth-child(odd)  {
		background: #BEE6D5;
	}
tbody  tr:hover {
		background: yellow;
	}
table {
		border-collapse: collapse;
	}  
.table a
{
    display:block;
    text-decoration:none;
}

#f1{
	font-weight:bold
}

.p2 {
    font-size: 20px;
	font-weight:bold;
    position: relative;
    top: 11px;
	left: 20px;
	}

select { 
	appearance: none; 
    outline: 0; 
    background: white; 
    background-image: none; 
    border:1px solid black; 
    font:14px arial;
  	} 

.select { 
    width: 10%; 
    height: 33em; 
    line-height: 3; 
    background: #d3eaf8; 
    overflow: hidden; 
    border-radius: .25em; 
    }	

label {
	font:12px arial;
}

#first {
    width: 50%;
    float: left;
}

#second {
    width: 50%;
    float: left;
}

#ckboxes {	/* pushes checkbox a little from sidebar left edge */
	padding-left: 1px;
}

.slidecontainer {
  width: 100%; /* Width of the outside container */
}

/* The slider itself */
.slider {
  appearance: none;
  width: 90%; /* Full-width */
  height: 10px; /* Specified height */
  background: #d3d3d3; /* Grey background */
  opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
 }

</style>
</head>
<body>

<div id="wrapper">
	<div id="panel"><span class="p2">DUMP978 - WX Display</span> </div>
  	<div id="map"></div>
  
	<div class="sidebar">
	<p style="text-align:center; font-size: 12px; color:#175B81; 
		font-weight:bold; "><span id="metar">Details</span></p>	 

<div id="ckboxes">
	<div class="checkbox">
		<label>
			<input type="checkbox"  id="meta" name="meta" checked><b>METAR</b><br>
        </label>
 	</div>
	<div class="checkbox">
		<label>
			<input type="checkbox"  id="notam" name="notam" checked><b>NOTAM</b><br>
        </label>
 	</div> 	
 	
			
<table  style="width:90%">
	<tr>
       	<th align="left">Station</th>
       	<td id='f1'></td>
	</tr> <tr>
       	<th align="left">Location</th>
       	<td id='f2'></td></tr>
    <tr>
   		<th align="left">Time</th>
       	<td id='f3'></td>
    </tr> <tr>
		<th align="left">Temp</th>
       	<td id='f4'></td>
    </tr> <tr>
       	<th align="left">Wind Speed</th>
       	<td id='f5'></td></tr>
     <tr>
		<th align="left">Visibility</th>
       	<td id='f6'><a href="#"></a></td>
 </table>
			   
<hr>
   
 <div class ='container'>
	<div id="first">
    	<label>
			<input type="checkbox"  id="gmet" name="gmet" checked><b>G-AIRMET</b><br>
	    </label> 
	</div>
<div class="slidecontainer">
	<input type="range" min="-1000" max="65000" value="-1000" 
  		class="slider" id="gmsliderRange">
    <p>Value: <span id="demo"></span></p> 
</div>	
	<div id="first">
    	<label>
			<input type="checkbox"  id="amet" name="amet" checked><b>AIRMET </b><br>
   		</label> 
	</div>
<div class="slidecontainer">
	<input type="range" min="-1000" max="65000" value="-1000" 
  		class="slider" id="amsliderRange">
    <p>Value: <span id="demo1"></span></p> 
</div>
		
	<div id="first">
   		<label>
			<input type="checkbox"  id="smet" name="smet" checked><b>SIGMET </b><br>
   		</label> 
	</div>	
<div class="slidecontainer">
	<input type="range" min="-1000" max="65000" value="-1000" 
  		class="slider" id="smsliderRange">
    <p>Value: <span id="demo2"></span></p> 
</div>

</div>	
	

<hr>
<table  style="width:90%">
	<tr>
       	<th align="left">Type</th>
       	<td id='f11'></td>
	</tr> <tr>
       	<th align="left">Altitude</th>
       	<td id='f12'></td></tr>
   	<tr>
   		<th align="left">Report#</th>
       	<td id='f13'></td>
    </tr> <tr>
		<th align="left">Condition</th>
       	<td id='f14'><a href="#"></a></td>
</table>

</div>
</div>
<div id="footer">  </div>
</div>
<script>

window.onload = onPageLoad();
function onPageLoad() {
	document.getElementById("gmet").checked = true;
	document.getElementById("meta").checked = true;
    document.getElementById("amet").checked = true;
    document.getElementById("smet").checked = true;
    document.getElementById("notam").checked = true;

	document.getElementById("gmsliderRange").step = "1000";
	document.getElementById("amsliderRange").step = "1000";
	document.getElementById("smsliderRange").step = "1000";
	document.getElementById("gmsliderRange").value = "0";
	document.getElementById("amsliderRange").value = "0";
	document.getElementById("smsliderRange").value = "0";
}

function reloadFunc(obj){
			  location.reload();
	}

var map = L.map('map').setView([36.0, -75.26], 5); 

var osm=new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',{ 
		attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);;
var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
});
var Esri_WorldGrayCanvas = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
		maxZoom: 16
});
var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});

function getColor(colf){
	return 	colf >=	60000 ? '#67BDE9':
			colf >=	50000 ? '#6EBAE0':
			colf >=	43000 ? '#75B7D6':
			colf >=	42000 ? '#7CB4CD':
			colf >=	40000 ? '#83B1C3':
			colf >=	32000 ? '#8AADBA':
			colf >=	24000 ? '#91AAB0':
			colf >=	22000 ? '#98A7A7':
			colf >=	20000 ? '#9FA49D':
			colf >=	18000 ? '#A6A194':
			colf >=	16000 ? '#AD9E8A':
			colf >=	12000 ? '#B49B81':
			colf >=	10000 ? '#BB9877':
			colf >=	9000  ? '#C2956E':
			colf >=	8000  ? '#C99264':
			colf >=	7000  ? '#D08E5B':
			colf >=	6000  ? '#D78B51':
			colf >=	4000  ? '#DE8848':
			colf >=	1000  ? '#E5853E':
			colf >=	0 	  ?	'#EC8235':
							'blue';
}	

// G-AIRMET

var gairmet = L.realtime({
     	url: 'http://localhost:4000/gairmet.geojson',
		crossOrigin: true, type: 'json'
	}, {interval: 12 * 1000,
		style: function(feature){
			kolor  = getColor(feature.properties.Alt);
			return { color: '#5D8C8C', weight: 2, fillColor: kolor,opacity: 1.0,fillOpacity: 0.2};
		},
			getFeatureId: function(featureData){
				return featureData.properties.RepNum;
		},
 			onEachFeature: function (feature, layer){
				layer.bindTooltip('G-AIRMET: Alt '+ feature.properties.Alt);
	           	layer.on('click',function(e){
					layer.setStyle({color: 'yellow',opacity: 0.8, fillColor: 'yellow', fillOpacity: 0.5});
					$('#f11').html('G-AIRMET');
					$('#f12').html(e.target.feature.properties.Alt);
					$('#f13').html(e.target.feature.properties.RepNum);
					$('#f14').html(e.target.feature.properties.Ob);
					gairmet.stop();});
	           layer.on('mouseout',function(e){
					gairmet.start();})		
			},
				filter: function(feature, layer) {   
//					var n = document.getElementById("bgalt").value;
					var rangeslider = document.getElementById("gmsliderRange");
					var output = document.getElementById("demo");
					if (rangeslider.value== -1000) output.innerHTML = "All"
					 else output.innerHTML = rangeslider.value;
				 
					var nn = parseInt(rangeslider.value, 10);
//					var nn = parseInt(n, 10);
					if (nn== -1000) return (feature.properties.Alt)
					else
					return (feature.properties.Alt >= (nn-500) && feature.properties.Alt <= (nn +500) );
				}
		}).addTo(map);  

// AIRMET
var	airmet = L.realtime({
     	url: 'http://localhost:4000/airmet.geojson',
		crossOrigin: true, type: 'json'
	}, {interval: 12 * 1020,
		style: function(feature){
			kolor  = getColor(feature.properties.Alt);
				return { color: '#00cccc', weight: 2, fillColor: kolor,opacity: 1.0,fillOpacity: 0.2};
		},
			getFeatureId: function(featureData){
				return featureData.properties.RepNum;
		},
			onEachFeature: function (feature, layer) 
			{
				layer.bindTooltip('AIRMET: Alt ' + feature.properties.Alt);
	           	layer.on('click',function(e){
					layer.setStyle({fillColor: 'yellow', fillOpacity: 0.5});
					$('#f11').html('AIRMET');
					$('#f12').html(e.target.feature.properties.Alt);
					$('#f13').html(e.target.feature.properties.RepNum);
					$('#f14').html('n/a');
					airmet.stop();});
	           layer.on('mouseout',function(e){
					airmet.start();})		
			},
				filter: function(feature,layer) {   
//					var n = document.getElementById("agalt").value;
					var rangeslider = document.getElementById("amsliderRange");
					var output = document.getElementById("demo1");
					if (rangeslider.value== -1000) output.innerHTML = "All"
					 else output.innerHTML = rangeslider.value;
					var nn = parseInt(rangeslider.value, 10);
					if (nn== -1000) return (feature.properties.Alt)
					else
					return (feature.properties.Alt >= (nn-500) && feature.properties.Alt <= (nn +500) );
				}
		}).addTo(map);

// SIGMET
var	sigmet = L.realtime({
     	url: 'http://localhost:4000/sigmet.geojson',
		crossOrigin: true, type: 'json'
	}, {interval: 12 * 1030,
		style: function(feature){
			kolor  = getColor(feature.properties.Alt);
				return { color: '#00cccc', weight: 2, fillColor: kolor,opacity: 1.0,fillOpacity: 0.2};
		},
			getFeatureId: function(featureData){
				return featureData.properties.RepNum;
		},
			onEachFeature: function (feature, layer) 
			{
				layer.bindTooltip('SIGMET: Alt ' + feature.properties.Alt);
	           	layer.on('click',function(e){
					layer.setStyle({fillColor: 'yellow', fillOpacity: 0.5});
					$('#f11').html('SIGMET');
					$('#f12').html(e.target.feature.properties.Alt);
					$('#f13').html(e.target.feature.properties.RepNum);
					$('#f14').html('n/a');
					sigmet.stop();});
	           layer.on('mouseout',function(e){
					sigmet.start();})		
			},
				filter: function(feature,layer) {   
//					var n = document.getElementById("sgalt").value;
					var rangeslider = document.getElementById("smsliderRange");
					var output = document.getElementById("demo2");
					if (rangeslider.value== -1000) output.innerHTML = "All"
					 else output.innerHTML = rangeslider.value;
					var nn = parseInt(rangeslider.value, 10);
					if (nn== -1000) return (feature.properties.Alt)
					else
					return (feature.properties.Alt >= (nn-500) && feature.properties.Alt <= (nn +500) );
				}
		}).addTo(map);  

// ** METAR 

var wxIcon = L.icon({iconUrl: 'therm.ico', iconSize: [35,35]});

metar = L.realtime({
	url:  'http://localhost:4000/sql?q=select s.coords as geom,m.stn_call,s.stn_loc,ob_date,' 
	+ 'temp,windsp,winddir,altimeter,visby,dewp '
	+ 'from metar m ,stations s where m.stn_call=s.stn_call',
		crossOrigin: true, type: 'json'
	}, {interval: 7 * 1000,
  		getFeatureId: function(featureData) {
			return featureData.properties.stn_call;
		},
		pointToLayer: function (feature, latlng) {
			marker = L.marker(latlng,{icon: wxIcon});
    		marker.bindTooltip(feature.properties.stn_call 
    				+ '<br>' + feature.properties.temp   +'&#x2109');
 			marker.on('click', function (e) {
					$('#f1').html(e.target.feature.properties.stn_call);
					$('#f2').html(e.target.feature.properties.stn_loc);
					$('#f3').html(e.target.feature.properties.ob_date);
					$('#f4').html(e.target.feature.properties.temp);
					$('#f5').html(e.target.feature.properties.windsp);  
					$('#f6').html(e.target.feature.properties.visby);
			});
    		marker.addTo(map);
    		return marker;
		}
	}).addTo(map);

// ** NOTAM 
var wxIcon2 = L.icon({iconUrl: 'wx2.ico', iconSize: [20,20]});

notam = L.realtime({
	url: 'http://localhost:4000/sql?q=select coords as geom,n.stn_call,stn_loc,rep_num,notam_text ' 
	+ 'from notam n, stations s where n.stn_call=s.stn_call',
		crossOrigin: true, type: 'json'
	}, {interval: 9 * 1000,
  		getFeatureId: function(featureData) {
			return featureData.properties.stn_call;
		},
		pointToLayer: function (feature, latlng) {
			marker = L.marker(latlng,{icon: wxIcon2});
    		marker.bindTooltip(feature.properties.stn_call);
 			marker.on('click', function (e) {
					$('#f1').html(e.target.feature.properties.stn_call);
					$('#f2').html(e.target.feature.properties.stn_loc);
					$('#f3').html(e.target.feature.properties.rep_num);
					$('#f4').html(e.target.feature.properties.notam_text);
//					$('#f5').html(e.target.feature.properties.WindSp);  
//					$('#f6').html(e.target.feature.properties.Vsby);
			});
    		marker.addTo(map);
    		return marker;
		}
	}).addTo(map);

// Handles the check boxes being turned on/off
document.querySelector("input[name=gmet]").addEventListener('change', function() {
                if(this.checked) {map.addLayer(gairmet),gairmet.start()}
                  else {map.removeLayer(gairmet),gairmet.stop()}
                })
   
document.querySelector("input[name=amet]").addEventListener('change', function() {
                if(this.checked)  {map.addLayer(airmet),airmet.start()}
                  else {map.removeLayer(airmet),airmet.stop()}
                })

document.querySelector("input[name=meta]").addEventListener('change', function() {
                if(this.checked)  {map.addLayer(metar),metar.start()}
                  else {map.removeLayer(metar),metar.stop()}
                })

document.querySelector("input[name=notam]").addEventListener('change', function() {
                if(this.checked)  {map.addLayer(notam),notam.start()}
                  else {map.removeLayer(notam),notam.stop()}
                })

document.querySelector("input[name=smet]").addEventListener('change', function() {
                if(this.checked)  {map.addLayer(sigmet),sigmet.start()}
                  else {map.removeLayer(sigmet),sigmet.stop()}
                })

//document.getElementById("bgalt").onchange = function()
//		{gairmet.update()}
		                
//document.getElementById("agalt").onchange = function()
//		{airmet.update()}

//document.getElementById("sgalt").onchange = function()
//		{sigmet.update()}  
		
document.getElementById("gmsliderRange").onchange = function()
	{gairmet.update()}
document.getElementById("amsliderRange").onchange = function()
	{airmet.update()}
document.getElementById("smsliderRange").onchange = function()
	{sigmet.update()}


//Add layer control
var baseMaps = {
    "Open Street Map": osm,
    "Imagery":Esri_WorldImagery,
	"Gray":Esri_WorldGrayCanvas,
	"OSM B&W":OpenStreetMap_BlackAndWhite
};

var overlayMaps = {};
L.control.layers(baseMaps, overlayMaps).addTo(map);


</script>

</body>
</html>
